<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Farcaster FID Checker</title>

  <meta name="fc:miniapp" content='{"homeURL":"https://scorecast-beryl.vercel.app/","icon":"https://scorecast-beryl.vercel.app/assets/icon-192.png"}'>
  <meta property="og:title" content="Farcaster FID Checker">
  <meta property="og:description" content="See your Farcaster FID and profile photo instantly.">

  <style>
    :root {
      --accent-bg: #6F42C1;
      --card-bg: rgba(255,255,255,0.08);
      --text: #ffffff;
      --muted: rgba(255,255,255,0.8);
    }
    html,body {
      height:100%;margin:0;
      font-family:Inter, ui-sans-serif, system-ui;
      color:var(--text);
    }
    body {
      display:flex;align-items:center;justify-content:center;
      background-color:var(--accent-bg);
      padding:24px;
    }
    .container {
      width:100%;max-width:420px;
      background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));
      border-radius:16px;padding:28px;
      box-shadow:0 8px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    .header {display:flex;gap:12px;margin-bottom:18px;align-items:center;}
    .logo img {width:40px;height:40px;border-radius:8px;}
    .title {font-size:18px;font-weight:600;}
    .subtitle {font-size:13px;color:var(--muted);margin-top:4px;}

    .card {
      display:flex;flex-direction:column;
      align-items:center;padding:20px;
      background:var(--card-bg);
      border-radius:12px;
    }
    .avatar {
      width:120px;height:120px;border-radius:50%;
      object-fit:cover;
      border:4px solid rgba(255,255,255,0.12);
      box-shadow:0 6px 18px rgba(0,0,0,0.35);
    }
    .fid-row {display:flex;gap:10px;margin-top:14px;align-items:center;}
    .fid-text {
      font-family:monospace;padding:6px 10px;
      border:1px dashed rgba(255,255,255,0.12);
      border-radius:8px;font-weight:600;
    }
    .copy-btn {
      padding:8px 12px;border-radius:10px;
      border:none;background:rgba(255,255,255,0.08);
      color:white;font-weight:600;cursor:pointer;
    }
    .small {font-size:13px;color:var(--muted);margin-top:12px;}
    .error {display:none;color:#ffdddd;background:rgba(0,0,0,0.2);padding:8px;border-radius:8px;margin-top:12px;}
    .spinner {
      width:36px;height:36px;border-radius:50%;
      border:4px solid rgba(255,255,255,0.12);
      border-top-color:white;
      animation:spin 1s linear infinite; margin:12px auto;
    }
    @keyframes spin {to {transform:rotate(360deg);}}
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <img src="assets/icon-192.png" alt="">
      </div>
      <div>
        <div class="title">Farcaster FID Checker</div>
        <div class="subtitle">Automatically shows your Farcaster FID & profile photo</div>
      </div>
    </div>

    <div class="card" id="card">
      <img id="avatar" src="assets/default-avatar.png" class="avatar">
      <div class="fid-row">
        <div class="fid-text" id="fid">—</div>
        <button class="copy-btn" id="copyBtn">Copy</button>
      </div>
      <div class="small" id="status">Detecting your Farcaster profile…</div>
      <div class="spinner" id="spinner"></div>
      <div class="error" id="error"></div>
    </div>
  </div>

<script type="module">
const SDK_URL = "https://cdn.jsdelivr.net/npm/@farcaster/miniapp-sdk/dist/miniapp-sdk.esm.js";

const avatarEl = document.getElementById("avatar");
const fidEl = document.getElementById("fid");
const statusEl = document.getElementById("status");
const spinner = document.getElementById("spinner");
const errorEl = document.getElementById("error");
const copyBtn = document.getElementById("copyBtn");

function hideSpinner(){ spinner.style.display = "none"; }
function showError(msg){
  hideSpinner();
  errorEl.style.display="block";
  errorEl.textContent = msg;
}

async function loadSDK(){
  try { return await import(SDK_URL); }
  catch { return null; }
}

function setupCopy(fid){
  copyBtn.onclick = async () => {
    await navigator.clipboard.writeText(fid);
    copyBtn.textContent = "Copied";
    setTimeout(() => copyBtn.textContent = "Copy", 1200);
  };
}

function renderUser(user){
  hideSpinner();
  const fid = user?.fid ?? user?.id ?? "unknown";
  const avatar = user?.profile?.picture ?? user?.avatar ?? null;

  fidEl.textContent = fid;
  if(avatar) avatarEl.src = avatar;

  statusEl.textContent = "You are signed in";
  setupCopy(fid);
}

function renderLoginButton(auth){
  hideSpinner();
  statusEl.textContent = "Sign in required — tap to sign in";
  const btn = document.createElement("button");
  btn.className = "copy-btn";
  btn.textContent = "Sign in with Farcaster";
  btn.onclick = async () => {
    try {
      const user = await auth.login();
      renderUser(user);
    } catch(e){
      showError("Sign in failed");
    }
  };
  document.getElementById("card").appendChild(btn);
}

async function start(){
  const sdk = await loadSDK();
  if(!sdk) return showError("SDK unavailable — open inside a Farcaster client.");

  sdk.ready?.();

  let user = null;
  try { user = await sdk.auth?.getCurrentUser?.(); } catch{}
  if(!user) try { user = await sdk.auth?.login?.({prompt:false}); } catch{}

  if(user) return renderUser(user);

  const caps = await sdk.detectHostCapabilities?.();
  if(caps?.auth) return renderLoginButton(sdk.auth);

  showError("No user detected.");
}

window.onload = start;
</script>

</body>
</html>
